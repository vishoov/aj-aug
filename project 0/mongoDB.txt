MONGODB


Mongo shell -> command line interface for interacting with the MongoDB DBs

Why do we use mongosh

Javascript environment 
Enhanced syntax 
Cross platform support
With or without compass 


Mongodb compass

Its a graphical user interface (GUI) for mongoDB, it makes db management more interactive 

features->
Data visualisation
Inbuilt mongo shell
Document viewer


MongoDB Atlas


Mongo Shell Commands


DATABASE LEVEL COMMANDS—-------------------------------------
Show dbs -> to list all the databases
Use db_name -> mongo shell either switches to that db if it exists or creates a new db for that name if that already doesnt exist 
db.Dropdatabase() -> deletes the whole database
db.stats() -> it will show all the statistics of the database 
Db -> it will show you the name of the current db

Inside the db

Show collections 
db.createCollection(‘name’) -> creates a new collection inside the db
db.collection_name.drop() -> this deletes the collection
db.collection_name.stats() -> get the statistics of the db
db.collection_name.renameCollection(‘new_name’) -> renames the collection

To clear the shell -> cls

Sharding -> this refers to scaling of the databases horizontally

CRUD OPERATIONS
https://www.mongodb.com/docs/manual/introduction/ 


MONGOOSE CRUD COMMANDS

CRUD 

create


SINGLE user
1)  Model.create(data) -> model.create method 
2) new keyword -> user constructor + save()
    new User(user)
    await save();


Multiple users 
3) User.insertMany(users_array)

Read

find()  -> returns an array of objects
findOne() -> return only the FIRST OBJECT that MATCHES the condition


A. Find all Users 
1) User.find();
2) When we only want specific fields - User.find({}, 'name email');
3) User.find(
    {},
    '-field' -> this - will exclude this field 
)
4) User.find().lean() -> this returns plain objects for increased efficiency


CONDITIONS 

5) find the user whos name is Accio 
    User.find(
        {
            field:"Value"
        }
    )

6) match multiple conditions 

LOGICAL Operators

AND,
  const user = await User.find(
            {
                $and:[
                    {
                        email:"accio@accio.com"
                    },
                    {
                        role:"user"
                    }
                ]
            }
        )




OR,

  const user = await User.find(
            {
                $or:[
                    {
                        email:"accio@accio.com"
                    },
                    {
                        role:"user"
                    }
                ]
            }
        )

NOR
  const user = await User.find(
            {
                $nor:[
                    {
                        email:"accio@accio.com"
                    },
                    {
                        role:"user"
                    }
                ]
            }
        )

Comparison Operators

  //comparing the ages 
        const users = await User.find(
            {
                //age should be greater than 18
                age:{
                    $comparison : 10
                }
            }
        )

comparison      syntax
    >              $gt 
    <               $lt
    >=              $gte
    <=              $lte
    !=                $ne

Range Comparison 

age > 18 and age<50
A)   age:{
                    $gt:10, //age should be greater than 10
                    $lt:50 //age should be less than 50
                }
B) age >18 AND age <50
 {

               $and:[
                {
                    age:{
                        $gt:18
                    }
                },
                {
                    age:{
                        $lt:50
                    }
                }
               ]
            }

age : 18, 20, 50, 40

$in -> the value should exist in these permitted values 
 {
                age:{
                    $in : [ 30, 40, 18] //find users with age 20, 30, 40 or 18
                }
            }

$nin: not in this 


update

1) User.updateOne(
    {
        //contains the condition that will be matched with the user
    },
    {
        $set :{
            {
                value:"new value"
            }
        }
    }
)

2. User.updateMany(
    {
        //write a query here that is true for many users
    },
    {
        $set:{
            key:value 
        }
    }
)

3. FindOneAndUpdate -> mongoose specific -> options 
User.findOneAndUpdate(
    {
        //matching
    },
    {
        $set:{
            new value
        }
    },
    {
        new:true //returns the updated document from scratch
        upsert:true, //create a new document if it already does not exist
        runValidators:true, //Run schema validators 

    }
)

4. this is one of the most efficient update queries that we have 
non blocking 
user experience 

User.findByIdAndUpdate(
    userId, 
    {
        //update information
        $set:{
            key:value
        }
    },
    {
        new:true,
        runValidators:true
    }
)

5. when we have to replace entire document except for id
replaceOne({
//matching condition
},{
    object 
})

delete 

deleteOne()

User.deleteOne({
    email:"abc@gmail.com"
})

deleteMany() 

User.deleteMany({
    email:"123@234.com"
})


User.findOneAndDelete(
    {
        email:email
    }
)


User.findByIdAndDelete(userId)


//role -> dynamic route -> find users by role 

router.get("/userbyrole", async(req,res) => {
  try{
    const {role} = req.body;
    const users = await User.find({role:role});
    if(!users){
      res.json({message:"no User with that role"})
    }
    res.status(200).json({message:"users found", users:users})
  }
  catch(err){
    res.send(err.message);
  }
})








//adult admins 
//optionl -> signed up in the last month or last 30 days 
//optional -> only display their name and email 